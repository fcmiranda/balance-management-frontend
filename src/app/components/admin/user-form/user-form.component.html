<div class="min-h-screen bg-gradient-to-br flex items-center justify-center p-8">
  <mat-card class="w-full max-w-2xl shadow-2xl rounded-2xl">
    <mat-card-header class="bg-gradient-to-r p-8 rounded-t-2xl">
      <mat-card-title class="flex items-center gap-3 text-2xl font-bold">
        <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
        <span>{{ pageTitle }}</span>
      </mat-card-title>
      <mat-card-subtitle class="text-blue-100 mt-2">
        {{ isEditMode ? 'Atualize as informações e permissões do usuário' : 'Adicione um novo usuário ao sistema' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="p-8">
      @if (loading) {
        <div class="flex flex-col items-center justify-center py-12">
          <mat-spinner diameter="40"></mat-spinner>
          <p class="mt-4 text-gray-600">Carregando dados do usuário...</p>
        </div>
      } @else {
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">
          <!-- Name Field -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Nome Completo</mat-label>
            <input 
              matInput 
              formControlName="name" 
              placeholder="Digite o nome completo"
              [class.mat-form-field-invalid]="userForm.get('name')?.invalid && userForm.get('name')?.touched"
            >
            <mat-icon matSuffix>person</mat-icon>
            <mat-error *ngIf="userForm.get('name')?.hasError('required')">
              Nome é obrigatório
            </mat-error>
            <mat-error *ngIf="userForm.get('name')?.hasError('minlength')">
              Nome deve ter pelo menos 2 caracteres
            </mat-error>
          </mat-form-field>

          <!-- Email Field -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Endereço de Email</mat-label>
            <input 
              matInput 
              type="email"
              formControlName="email" 
              placeholder="Digite o endereço de email"
              [class.mat-form-field-invalid]="userForm.get('email')?.invalid && userForm.get('email')?.touched"
            >
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="userForm.get('email')?.hasError('required')">
              Email é obrigatório
            </mat-error>
            <mat-error *ngIf="userForm.get('email')?.hasError('email')">
              Por favor, digite um endereço de email válido
            </mat-error>
          </mat-form-field>

          <!-- Role Field -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Função do Usuário</mat-label>
            <mat-select formControlName="role">
              @for (role of roles; track role) {
                <mat-option [value]="role">
                  <div class="flex items-center gap-3 w-full">
                    <mat-chip [color]="getRoleColor(role)" selected class="text-xs">
                      {{ role | titlecase }}
                    </mat-chip>
                    <span class="text-sm text-gray-600">
                      {{ role === 'admin' ? 'Acesso completo ao sistema' : 'Acesso padrão de usuário' }}
                    </span>
                  </div>
                </mat-option>
              }
            </mat-select>
            <mat-icon matSuffix>admin_panel_settings</mat-icon>
            <mat-error *ngIf="userForm.get('role')?.hasError('required')">
              Por favor, selecione uma função
            </mat-error>
          </mat-form-field>

          <!-- Password Section -->
          <div class="border-t pt-6 mt-6">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">
              {{ isEditMode ? 'Alterar Senha (Opcional)' : 'Senha' }}
            </h3>
            @if (isEditMode) {
              <p class="text-sm text-gray-500 italic mb-4">Deixe em branco para manter a senha atual</p>
            }

            <!-- Password Field -->
            <mat-form-field appearance="outline" class="w-full mb-4">
              <mat-label>{{ isEditMode ? 'Nova Senha' : 'Senha' }}</mat-label>
              <input 
                matInput 
                [type]="hidePassword ? 'password' : 'text'" 
                formControlName="password" 
                [placeholder]="isEditMode ? 'Digite a nova senha (opcional)' : 'Digite a senha'"
                [class.mat-form-field-invalid]="userForm.get('password')?.invalid && userForm.get('password')?.touched"
              >
              <button 
                mat-icon-button 
                matSuffix 
                (click)="hidePassword = !hidePassword"
                type="button"
              >
                <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="userForm.get('password')?.hasError('required')">
                Senha é obrigatória
              </mat-error>
              <mat-error *ngIf="userForm.get('password')?.hasError('minlength')">
                Senha deve ter pelo menos 6 caracteres
              </mat-error>
            </mat-form-field>

            <!-- Confirm Password Field -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Confirmar Senha</mat-label>
              <input 
                matInput 
                [type]="hideConfirmPassword ? 'password' : 'text'" 
                formControlName="confirmPassword" 
                placeholder="Confirme a senha"
                [class.mat-form-field-invalid]="userForm.get('confirmPassword')?.invalid && userForm.get('confirmPassword')?.touched"
              >
              <button 
                mat-icon-button 
                matSuffix 
                (click)="hideConfirmPassword = !hideConfirmPassword"
                type="button"
              >
                <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="userForm.get('confirmPassword')?.hasError('required')">
                Por favor, confirme sua senha
              </mat-error>
              <mat-error *ngIf="userForm.hasError('passwordMismatch') && userForm.get('confirmPassword')?.touched">
                Senhas não coincidem
              </mat-error>
            </mat-form-field>
          </div>
        </form>
      }
    </mat-card-content>

    <mat-card-actions class="flex gap-4 justify-end p-6 border-t border-gray-200">
      <button 
        mat-button 
        type="button"
        (click)="onCancel()"
        [disabled]="submitting"
        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
      >
        <mat-icon class="mr-2">cancel</mat-icon>
        Cancelar
      </button>
      
      <button 
        mat-raised-button 
        color="primary" 
        type="submit"
        (click)="onSubmit()"
        [disabled]="userForm.invalid || submitting || loading"
        class="px-6 py-2 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-300"
      >
        @if (submitting) {
          <mat-spinner diameter="20" class="mr-2"></mat-spinner>
        } @else {
          <mat-icon class="mr-2">{{ isEditMode ? 'save' : 'person_add' }}</mat-icon>
        }
        {{ submitButtonText }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
